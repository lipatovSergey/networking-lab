## Lab 4 — TLS / HTTPS (Summary)

### Цель лаборатории

Понять, как на самом деле работает HTTPS:
как TLS устанавливает защищённое соединение,
какую роль играют сертификаты,
и откуда берётся шифрование.

---

### HTTPS как стек протоколов

HTTPS — это **не отдельный протокол**, а комбинация уровней:

```
HTTP   — контракт запросов и ответов
TLS    — шифрование и аутентификация
TCP    — надёжная доставка байтов
```

HTTP не знает о TLS, TLS не знает об HTTP — каждый слой независим.

---

### Роль сертификатов

Сертификаты используются **не для шифрования трафика**, а для **аутентификации сервера**.

В TLS применяется цепочка сертификатов:

```
Leaf certificate      (*.google.com)
Intermediate CA       (WR2)
Root CA               (GTS Root R1)
```

Каждый сертификат:

- подписан **ровно один раз**
- проверяется **отдельно**
- имеет срок действия и ограничения

---

### Chain of Trust

Проверка сертификата выполняется **клиентом**, а не сервером:

1. Сертификат сайта (`*.google.com`)
   проверяется публичным ключом **WR2**
2. Сертификат WR2
   проверяется публичным ключом **GTS Root R1**
3. Root CA (`GTS Root R1`)
   должен присутствовать в **trust store** клиента

Если **любой** сертификат в цепочке:

- истёк
- отозван
- имеет неверную подпись

→ всё соединение считается небезопасным.

Root CA **не “прикрывает” ошибки intermediate** — каждый уровень обязан быть валидным.

---

### Trust Store

Trust store — это хранилище **root-сертификатов**, встроенное в ОС или браузер.

Root-сертификату:

- **доверяют по факту наличия**
- его подпись не проверяется криптографически
- он является якорем доверия всей цепочки

Добавление root-сертификата в trust store — критически опасная операция.

---

### TLS Handshake (TLS 1.3, упрощённо)

1. Клиент инициирует TLS-соединение (`ClientHello`)
2. Сервер отвечает и отправляет сертификаты
3. Клиент проверяет цепочку доверия
4. Клиент и сервер обмениваются **публичными параметрами**
5. Каждая сторона **независимо вычисляет общий секрет**
6. Из секрета выводятся симметричные ключи
7. Начинается зашифрованный обмен данными

⚠️ Секрет **никогда не передаётся по сети**.

---

### Шифрование трафика

- Для передачи данных используется **симметричное шифрование** (например, AES-GCM)
- Асимметричная криптография применяется **только на этапе handshake**
- Сертификат **не участвует в шифровании трафика**, только в проверке подлинности сервера

---

### Ключевые выводы

- HTTPS = HTTP поверх TLS поверх TCP
- Сертификаты нужны для доверия, а не для шифрования
- Каждый сертификат в цепочке проверяется отдельно
- Root CA — якорь доверия, а не «магическая подпись»
- Общий секрет не передаётся, а вычисляется независимо
- Backend-разработчику важно понимать процесс, но не реализовывать TLS вручную
